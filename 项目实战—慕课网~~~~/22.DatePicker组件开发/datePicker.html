<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		*{
			margin: 0;
			padding: 0;
		}
		a{
			text-decoration: none;
		}
		.ui-datepicker-wrapper{
			width: 230px;
			height: 262px;
			border: 1px solid #ccc;
			box-shadow: 5px 5px 5px rgba(0,0,0,0.15);
			display: none;
			position: absolute;
		}
		.ui-datepicker-wrapper-show{
			display: block;
		}
		.ui-datepicker-wrapper .ui-datepicker-header{
			height: 40px;
			background: rgb(242,240,242);
			line-height: 40px;
			padding:0 20px;
			border-bottom: 2px solid #ddd;

		}
		.ui-datepicker-header .ui-datepicker-btn{
			color:#1abc9c;
			font-weight: 900;
		    width: 20px;
		    height: 20px;
		}
		.ui-datepicker-header .prev{
			float: left;
		}
		.ui-datepicker-header .next{
			float: right;
			text-align: right;
		}
		.ui-datepicker-header .ui-datepicker-curr-month{
			color:rgb(142,141,142);
			margin-left: 25px;
		}
		.ui-datepicker-wrapper .ui-datepicker-body table{
			text-align: center;
			color:rgb(142,141,142);
		}
		.ui-datepicker-wrapper .ui-datepicker-body thead th{
			font-weight: 900;

		}
		.ui-datepicker-wrapper .ui-datepicker-body tbody td{
			width: 30px;
			text-align: center;
			line-height: 30px;
			border:1px solid #eee;
			border-bottom:0;
			border-right:0;
			cursor: pointer;
		}
		


		.datepicker{
			border:1px solid #ccc;
			border-radius: 4px;
			padding: 5px;
			height:24px;
			line-height: 24px;
			width: 220px;
		}
		.datepicker:focus{
			outline:0 none;
			border:1px solid #1abc9c;
		}
	</style>
</head>
<body>
	<input type="text" class="datepicker">
	 <div class="ui-datepicker-wrapper">
				<!--	<div class="ui-datepicker-header">
			<a href="javascript:;" class="ui-datepicker-btn prev">&lt;</a>
			<a href="javascript:;" class="ui-datepicker-btn next">&gt;</a>
			<span class="ui-datepicker-curr-month">2016-12</span>
		</div>
		<div class="ui-datepicker-body">
			<table>
				<thead>
					<tr>
						<th>日</th>
						<th>一</th>
						<th>二</th>
						<th>三</th>
						<th>四</th>
						<th>五</th>
						<th>六</th>
					</tr>
				</thead>
			
				<tbody>
					<tr>
						<td>24</td>
						<td>25</td>
						<td>26</td>
						<td>27</td>
						<td>28</td>
						<td>29</td>
						<td>30</td>
					</tr>
			
					<tr>
						<td>1</td>
						<td>2</td>
						<td>3</td>
						<td>4</td>
						<td>5</td>
						<td>6</td>
						<td>7</td>
					</tr>
					
					<tr>
						<td>8</td>
						<td>9</td>
						<td>10</td>
						<td>11</td>
						<td>12</td>
						<td>13</td>
						<td>14</td>
					</tr>
					<tr>
						<td>15</td>
						<td>16</td>
						<td>17</td>
						<td>18</td>
						<td>19</td>
						<td>20</td>
						<td>21</td>
					</tr>
					<tr>
						<td>22</td>
						<td>23</td>
						<td>24</td>
						<td>25</td>
						<td>26</td>
						<td>27</td>
						<td>28</td>
					</tr>
					<tr>
						<td>29</td>
						<td>30</td>
						<td>31</td>
						<td>1</td>
						<td>2</td>
						<td>3</td>
						<td>4</td>
					</tr>
				</tbody>
			</table>
		</div>-->
	</div> 

	<script src="jquery.js"></script>
	<script src="mydata.js"></script>
	<script src="handlebars-v4.0.10.js"></script>
	<script id="date-body-template" type="text/x-handlebars-template">
		<table>
				<thead>
					<tr>
						<th>日</th>
						<th>一</th>
						<th>二</th>
						<th>三</th>
						<th>四</th>
						<th>五</th>
						<th>六</th>
					</tr>
				</thead>

				<tbody>
				{{#each this.date}}
					<tr>
						{{#each this}}
						<td>{{0}}</td>
						<td>{{1}}</td>
						<td>{{2}}</td>
						<td>{{3}}</td>
						<td>{{4}}</td>
						<td>{{5}}</td>
						<td>{{6}}</td>
						{{/each}}
					</tr>
				{{/each}}
				</tbody>
		</table>
	</script>

	<script id="date-header-template" type="text/x-handlebars-template">
		<a href="javascript:;" class="ui-datepicker-btn prev">&lt;</a>
		<a href="javascript:;" class="ui-datepicker-btn next">&gt;</a>
		<span class="ui-datepicker-curr-month">{{year}}-{{month}}</span>
	</script>

	<script id="date-wrapper-template" type="text/x-handlebars-template">
			<div class="ui-datepicker-header"></div>
			<div class="ui-datepicker-body"></div>
	</script>
	
	<script>
		$(function(){
			var isOpen = false;
			var $wrapper = $(".ui-datepicker-wrapper"),
				$input = $(".datepicker");
			var year,month;
			var now = new Date();
			year = now.getFullYear();
			month = now.getMonth() + 1;

			$(".datepicker").click(function(){

				var monthData = datepicker.getMonthData(year,month);
					year = monthData.year;
					month = monthData.month;
				renderTemplate("#date-wrapper-template",monthData,".ui-datepicker-wrapper");
								
				if(!isOpen){
					$wrapper.addClass("ui-datepicker-wrapper-show");
					var left = $input[0].offsetLeft;
					var	top = $input[0].offsetTop;
					var	height = $input[0].offsetHeight;
				
					console.log(left);

					$wrapper[0].style.left = left + "px";
					$wrapper[0].style.top = top + height + 2 + "px";
					isOpen = true;
				}else{
					$wrapper.removeClass("ui-datepicker-wrapper-show");
					isOpen = false;
				}

				renderTemplate("#date-header-template",monthData,".ui-datepicker-header");
				renderTemplate("#date-body-template",monthData,".ui-datepicker-body");


			});


			var $prev = $(".ui-datepicker-header .prev"),
				$next = $(".ui-datepicker-header .next");
			$prev.on("click",function(){
				month--;
			});

			/*console.log(monthData);
			var h = $("#date-body-template").html();
			var f = Handlebars.compile(h);
			var t =f(monthData);
			$(".ui-datepicker-body").html(t);

			var h = $("#date-header-template").html();
			var f = Handlebars.compile(h);
			var t =f(monthData);
			$(".ui-datepicker-header").html(t);*/
		});

		function renderTemplate(templateSelector,data,htmlSelector){
			var t = $(templateSelector).html();
			var f = Handlebars.compile(t);  //f是一个函数，为编译过的模板
			var h = f(data);  
			$(htmlSelector).html(h);
		}

		/*Handlebars.registerHelper("equal",function(v1,v2,options){
			if(parseInt(v1%8) === parseInt(v2)){
				return options.fn(this);
			}else{
				return options.inverse(this);
			}
		});*/
	</script>
</body>
</html>